[
  {
    "path": "posts/2021-06-21-the-changing-shape-of-the-tour-de-france/",
    "title": "The Changing Shape of the Tour de France",
    "description": "On the eve of the Grand Départ of the 2021 Tour de France, we'll use animation to quickly draw some insights from the race's history.",
    "author": [],
    "date": "2021-06-25",
    "categories": [
      "Visualisation",
      "Cycling"
    ],
    "contents": "\n\nContents\nMaillot Jaune\nLanterne Rouge\nR Code\n\n\n\n\nI first became interested in visualising how the Tour de France had changed over time after stumbling across Pierre Breteau’s visualisation in Le Monde, which shows the frequency with which each département of France has been visited by the race.\nPlaying around with the slider settings in Pierre’s visualisation, I wanted to be able to visualise how the shape of the race changed over time - prompting me to create this animation.\nI’ve taken the approach of visualising stage start/finish locations, rather than departments: to achieve that I’m indebted to the contributors to Wikipedia for their efforts to tabulate all of the stages in the Tour’s history, which I’ve scraped using R’s rvest package. The visualisation itself is built using ggplot2 and gganimate; the code is available at the end of this post.\nIn the sections below I’ll talk a about what I like about the visualisation and what I think could be improved.\nMaillot Jaune\nThe Maillot Jaune, Yellow Jersey, is famously worn by the rider in the lead of the race at the start of each stage, and finally awarded to the overall fastest rider when the race concludes in Paris.\nThe highlight of the animation for me is that it provides a compelling example of the benefits of animation for data story telling: enabling me to draw insights about the race that I’d have struggled to do from tables and static maps alone. Here’s a few points that I found interesting.\nThe early editions of the Tour had very few stages\nThe first and second editions of the Tour comprised just 6 stages, compared to today’s 21. Further digging into the data indicates the stage distances were however significantly longer than modern editions.\n\nThe longest stage in the 1903 Tour spanned 471km, compared to a maximum of 250km in 2021.\nA tour of the perimeter?\nThe Tour used to be largely about traversing the outer regions of France: between 1905 and 1938 the only detour away from the boarders seems to be the requisite annual visit to Paris.\nVariation was guaranteed for the riders every few years though, when the race organisers would change their preference for a clockwise or anti-clockwise route.\nThe Missing Years\nThe lack of animation in the periods 1915-1918 and 1940-46 are a reminder of the impact that the First and Second World Wars had on the routines and attractions that we take for granted.\nFurther reading led me to the interesting fact that a 1940 Tour was planned, with the intent that riders would be drafted from soldiers stationed in France.\n\nThere’s a lot more information on the Wikipedia page Tour de France during World War II.\nLate to the Party\nEven into the 1990s its possible to pick out by eye some departments that were yet to host the start or finish of a Tour stage. Hosting a tour stage costs and it could well be that these areas of the country had different ideas on how local taxes should be spent.\nPierre Breteau/Le Monde’s data allows an analysis of which departments the Tour passes through, not only where stages start or end. With the exception of Corsica (that was finally visited in 2013) and overseas territories, his data indicates that the final department to be visited was Indre in 1992.\nLanterne Rouge\nThe Lanterne Rouge, Red Lantern, is the dubious award given to the last placed rider in the Tour. Somewhat ironically its a title riders fight for as it comes with an offer to ride (and hence appearance fees) in the post-Tour Criterium races.\nThe animation is far from perfect, and could do with some tweaks and improvements - some of which I’ve listed below. Maybe I’ll get around to improving these ahead of Copenhagen 2022!\nStraight Lines, and Pedalo Races\nEvident from the very first frame of the animation is the simplification to straight line paths between stage start and end points. This is particularly stark when the route follows the coast, occasionally suggesting that the riders took to the water to complete the stage.\nA search for Tour de France shapefiles suggests that these don’t exist for public consumption, but detailed road books are published for recent editions of the race - so in theory perhaps more accurate paths could be traced from this data.\nTour de… Belgique?\nWhilst it took until 1992 for the Tour to visit every mainland department, the race first left France in 1947 with detours to both Brussels, and Luxembourg City.\nSince then the tour has made regular detours to nearby countries: for now I’ve removed these overseas excursions for want of a suitable way to incorporate them into the visualisation - but this feels like an easy fix for the future.\n5 of the last 10 Grand Departs have taken place elsewhere in Europe.\nImplausible Locations\nI’ve used geocoding to infer longitude/latitude coordinates from the start/finish location names, using the R tidygeocoder package. This isn’t always accurate, returning for instance Cherbourg, Australia instead of Cherbourg, France, or suggesting the 2010 Tour started at Rue de Rotterdam, Tours rather than Rotterdam in the Netherlands.\nThis leads to some pretty obvious errors in the animation, with implausible distances covered in a stage. An immediate data quality check that could be built in is to calculate the straight line distance between start/end points of a stage and flag if this is greater than the stage distance.\nR Code\n\n\n\n\nShow code\nlibrary(infreqthemes)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(gganimate)\nlibrary(tdfData) # install.github(\"odaniel1/tdfData\")\n\n## ---- prepare stage data --------------------------------------------------------------\n\n# TdF stage data was scraped from Wikipedia; it has some limitations (discussed above).\n# Its available in the tdfData package from my GitHub account\ntdf_stages <-tdf_stages %>% clean_names()\n\n# the TdF did not take place during WWI and WWII; create 'empty' stages so that\n# the animation marks these years.\nmissing_years <- crossing(year = c(1915:1918, 1940:1946), stage = as.character(1:10)) %>%\n  mutate(date = as.Date(paste0(year, \"-07-\",stage), '%Y-%m-%d'))\n\n# add missing years to the data; the stage_no column defines the order for the animation.\ntdf_stages <- bind_rows(tdf_stages, missing_years) %>%\n  arrange(date) %>%\n  mutate(stage_no=1:n())\n\n## ---- prepare plot data ---------------------------------------------------------------\n\n# The approach to getting lines to fade in gganimate is adapted from:\n# stackoverflow.com/questions/58271332/gganimate-plot-where-points-stay-and-line-fades\nplot_data <- tdf_stages %>%\n  uncount(nrow(tdf_stages), .id = \"frame\") %>%\n  filter(stage_no <= frame) %>%\n  arrange(frame, stage_no) %>%\n  group_by(frame) %>%\n  mutate(\n    # which edition of the TdF does the current frame visualise?\n    frame_year = max(year),\n    # how many stages ago was the stage first visualised created?\n    tail = last(stage_no) - stage_no,\n    # transparency set to be 1 (full) for first visualiation, and then fade.\n    # size set to be larger within same edition of TdF, and then shrink.\n    point_alpha = if_else(tail == 0, 1, 0.7),\n    point_size = if_else(year == frame_year, 2, 1),\n    # Fade lines over 20 stages, and remove once a new edition of the TdF starts.\n    segment_alpha = pmax(0, (20-tail)/20) * (year == frame_year)\n  ) %>%\n  ungroup()\n\n\n## ---- create plot ---------------------------------------------------------------------\n\n# raw (non-animated) plot\np <- ggplot(plot_data) +\n  \n  # used to dynamically add the edition of the TdF\n  geom_text(\n    data=plot_data, aes(-4, 50.5, label = frame_year),\n    size = 12, hjust = 0, color =infreq_palette[\"darkblue\"]\n  ) +\n  \n  # background map of france (coord_map fixes the aspect ratio)\n  geom_polygon(\n    data = map_data(\"france\"), aes(x=long, y = lat, group = group),\n    fill = \"#f3be02\", color = \"#f6f4e6\", size = 0.1\n  ) +\n  coord_map() +\n  \n  # stage start and finish locations as points\n  geom_point(\n    aes(x=start_longitude,y=start_latitude, alpha = point_alpha),\n    size = plot_data$point_size\n  ) +\n  geom_point(\n    aes(x=finish_longitude,y=finish_latitude,group=stage_no, alpha = point_alpha),\n    size = plot_data$point_size\n  ) +\n  \n  # line segment connecting stage start/finish points.\n  geom_segment(\n    aes(\n      x=start_longitude,\n      xend=finish_longitude,\n      y=start_latitude,\n      yend=finish_latitude,\n      alpha = segment_alpha\n    ), color = infreq_palette[\"orange\"]\n  ) +\n  \n  # set themes and legend\n  scale_alpha(range = c(0,1)) +\n  guides(alpha = \"none\") +\n  theme_void() +\n  transition_manual(frame)\n\n# create animation; speed is set to display 10 stages per second; completes in ~4mins.\nanim_stages <- animate(p,\n  nframes = max(plot_data$frame),\n  duration = max(tdf_stages$stage_no) * 0.1)\n\n\n\n\n\n\n\n\n\n",
    "preview": "posts/2021-06-21-the-changing-shape-of-the-tour-de-france/img/tdf_shape_1915.gif",
    "last_modified": "2021-06-24T22:13:41+01:00",
    "input_file": {}
  }
]
